\section{Cost-convexity}\label{sec:cost-convex}

In this section we review necessary material we learned from \cite{MTW+CTIL}; see also the references there in.

\parbf{Cost-convex functions.}
Let $M$ be a complete Riemannian manifold.
Consider the \emph{cost function} $\cost\:M\times M\to \RR$ defined by \[\cost(x,y)=\tfrac12\cdot|x-y|_M^2.\]

A function $f\:M\to (-\infty,\infty]$ is called \emph{cost-convex} if 
for any $p\in M$ such that $f(p)<\infty$ there is $q\in M$ such that 
\[f(x)+\cost(q,x)\ge f(p)+\cost(q,p)\]
for any $x\in M$.

If $M$ has nonnegative sectional curvature, then any cost-convex function $f$ is $(-1)$-convex;
that is, $f''\ge-1$ or, more precisely, the inequality 
\[(f\circ\gamma)''\ge -1
\eqlbl{eq:f''=<-1}\]
holds in the barrier sense for any unit speed geodesic $\gamma$.
On the other hand, $f''\ge -1$ does not imply that $f$ is cost-convex.


\parbf{Subgradient.}
Let $f\: M\to (-\infty,\infty]$ be a semiconvex function defined on the complete Riemannian manifold $M$.
Assume $f(p)$ is finite.
In this case the differential 
\[d_pf\:\T_p\zz\to (-\infty,\infty]\] 
is defined;
it is a convex positive homogeneous function defined on the tangent space $\T_p$.

A tangent vector $v\in \T_pM$ is a \emph{subgradient} of $f$ at $p$, briefly $v\in\ushort\nabla_pf$ if
\[\langle v,w\rangle\le d_pf(w)\]
for any $w\in \T_p$.
Note that the set $\ushort\nabla_pf$ is a convex subset of $\T_p$.

The subset of tangent vectors $v\in\T_p$ such that there is a minimizing geodesic $[p\,q]$ in the direction of $v$ with length $|v|$ will be denoted as $\overline{\TIL}_p$. 
For $p,q$ and $v$ as above, we write $q\zz=\exp_pv$.

\begin{thm}{Definition}\label{def:cost-convex}
A complete Riemannian manifold will be called \emph{cost-convex} if 
for any point $p$ and any cost-convex function $f$ that is finite at $p$ we have $\ushort\nabla_pf\subset\overline{\TIL}_p$
and for any $v\in\ushort\nabla_pf$ the inequality 
\[f(x)+\cost(q,x)\ge f(p)+\cost(q,p)\]
holds for $q=\exp_pv$ and any $x\in M$.
\end{thm}

Any cost-convex manifold has nonnegative sectional curvature.
To check the latter statement it is sufficient to apply the definition to the cost-convex functions of the type $f(x)=-\min\{\cost(a,x),\cost(b,x)\}$;
note that $\ushort\nabla_pf\ni 0$ at the midpoint $p$ of a geodesic $[ab]$,
therefore we can apply the inequality for $q=p=\exp_p0$.

Recall that $M$ satisfies the transport continuity property (or briefly $M$ is 
TCP) if, whenever $\mu$ and $\nu$ are absolutely continuous probability measures with respect
to the volume and their density functions bounded away from zero and infinity, then the optimal transport map for measures $\mu$, $\nu$ is continuous, up to modification
on a set of zero volume.
According to \cite{FRV-Nec+Suf} and Proposition~\ref{prop:cost-convex=CTIL+MTW}, if $M$ is TCP, then it is cost-convex.
The converse is unknown, likely it holds;
there is a strict version of cost-convexity which implies TCP, see \cite{FRV-Nec+Suf}.

\parbf{CTIL and MTW.}
Let us formulate other two conditions on Riemannian manifolds which are together equivalent to the cost-convexity.
These two conditions will be used in the proof.

Let $M$ be a complete Riemannian manifold.
The \emph{tangent injectivity locus} at the point $p\in M$ (briefly $\TIL_p$) is defined as the maximal open subset in the tangent space $\T_p$ such that for any $v\in\TIL_p$ the geodesic path $\gamma(t)=\exp_p(v\cdot t)$, $t\in [0,1]$ is minimizing.
If the tangent injectivity locus at any point $p\in M$ is convex we say that $M$ satisfies \emph{convexity of  tangent injectivity locus} or briefly $M$ is CTIL.

Note that the set $\overline{\TIL}_p$ defined above is closure of $\TIL_p$ in $\T_p$.
Therefore, $M$ is CTIL if and only if the set $\overline{\TIL}_p$ is convex for any point $p\in M$.

If $M$ is cost-convex, then it is CTIL.
Indeed, fix a point $p\in M$ and consider the cost-convex function 
\[f(x)=\sup \set{\cost(q,p)-\cost(q,x)}{q\in M}\]
It remains to note that $\ushort\nabla_pf=\overline{\TIL}_p$.

The second condition is called MTW for Ma--Trudinger--Wang.
We will use its reformulation close to the one given by CÃ©dric Villani \cite[2.6]{MTW+CTIL}; it can be proved the same way.

Assume $u,v\in \T_p$ and $w=\tfrac12\cdot(u+v)$
and $x=\exp_p u$, $y=\exp_pv$ and $q=\exp_pw$.
If the three geodesic paths $[p\,x]$, $[p\,y]$ and $[p\,q]$ described by the paths 
$t\mapsto\exp_p(t\cdot u)$,  $t\mapsto\exp_p(t\cdot v)$, $t\mapsto\exp_p(t\cdot w)$ for $t\in[0,1]$ are minimizing, then $[p\,q]$ is called \emph{median} of the hinge $[p\,^x_y]$.
Note that in a CTIL Riemannian manifold, any hinge has a median.

\begin{thm}{MTW condition}\label{MTW}
Assume $M$ be a CTIL Riemannian manifold. 
Then $M$ is MTW if and only if for a median $[p\,q]$ of any hinge $[p\,^x_y]$ one of the following inequalities
\[
\left[
\begin{aligned}
|p-q|^2_M-|z-q|^2_M&\le |p-x|^2_M-|z-x|^2_M,
\\
|p-q|^2_M-|z-q|^2_M&\le |p-y|^2_M-|z-y|^2_M.
\end{aligned}
\right.
\]
holds for any $z\in M$.
\end{thm}

The following statement was proved by Gr\'egoire Loeper in \cite{loeper}, see also \cite[Proposition 2.5]{MTW+CTIL}.

\begin{thm}{Proposition}\label{prop:cost-convex=CTIL+MTW}
A complete Riemannian manifold is cost-convex if and only if it is CTIL and MTW. 
\end{thm}









\section{4(1)-tree comparison}\label{7-dipole}



In this section we will prove the first part of Theorem \ref{T=>CTIL:CTIL}.
Note that according to Proposition~\ref{prop:cost-convex=CTIL+MTW}, it is sufficient to show that if a Riemannian manifold $M$ satisfies 4(1)-tree comparison, then it is CTIL and MTW.
These two conditions will be proved separately.

\begin{thm}{Proposition}\label{prop:CTIL}
Any complete cost-convex Riemannian manifold is CTIL.
\end{thm}

\parit{Proof.}
Let $M$ be a cost-convex Riemannian manifold.
Assume there is $p\in M$ and $u,v\zz\in \TIL_p$ such that $w=\tfrac12\cdot(u+v)\notin \TIL_p$.

Let $\tau$ be the maximal value such that the geodesic $\gamma(t)=\exp_p(w\cdot t)$ is a length-minimizing on $[0,\tau]$.
Set $w'=\tau\cdot w$.
Note that $\tau<1$ and $w'\in\partial \TIL_p$.


Set $q=\exp_p w'$.
By general position argument, we can assume that there are at least two minimizing geodesics connecting $p$ to $q$; see \cite{karcher}.
That is, there is $w''\in \partial \TIL_p$ such that 
$w''\ne w'$
and $\exp_pw'=\exp_pw''$.

\begin{center}
\begin{lpic}[t(-0 mm),b(-0 mm),r(0 mm),l(0 mm)]{pics/7-config(1)}
\lbl[r]{1.5,32;$x$}
\lbl[l]{59.5,31;$y$}
\lbl[t]{18.5,2;$y'$}
\lbl[t]{32.5,2;$x'$}
\lbl[t]{26,4.5;$p$}
\lbl[r]{22.5,16;$z$}
\lbl[r]{25,32;$q$}
\lbl[l]{28.5,27;$q'$}
\end{lpic}
\end{center}

Fix small positive real numbers $\delta,\eps$ and $\zeta$.
Consider the following points
\begin{align*}
q'=q'(\eps)&=\exp_p(1-\eps)\cdot w',
&
z=z(\zeta)&=\exp_p(\zeta\cdot w''),
\\
x&=\exp_p u,
&
x'=x'(\delta)&=\exp_p (-\delta\cdot u),
\\
y&=\exp_p v,
&
y'=y'(\delta)&=\exp_p (-\delta\cdot v).
\end{align*}

We will  show that for some choice of $\delta,\eps$ and $\zeta$ the tree comparison for $p/xx'yy'(q'/z)$ does not hold.

Assume contrary, that is, given any small positive numbers $\delta,\eps$ and $\zeta$, there is a point array $\~p$, $\~x$, $\~x'(\delta)$, $\~y$, $\~y'(\delta)$, $\~q'(\eps)$, $\~z(\zeta)\in\HH$ as in the definition of $T$-tree comparison.

\begin{wrapfigure}{r}{35 mm}
\begin{tikzpicture}[scale=1,
  thick,main node/.style={circle,draw,font=\sffamily\bfseries,minimum size=8mm}]

  \node[main node] (0) at (3/2,11/6){$x$};
   \node[main node] (1) at (1/2,1/6){$x'$};
  \node[main node] (2) at (3/2,.1){$y$};
  \node[main node] (3) at (1,1){$p$};
  \node[main node] (4) at (1/2,11/6){$y'$};
  \node[main node] (5) at (3,1){$z$};
  \node[main node] (6) at (2,1){$q'$};

  \path[every node/.style={font=\sffamily\small}]
     (0) edge node[above]{}(3)
   (1) edge node[above]{}(3)
   (2) edge node[above]{}(3)
   (3) edge node[above]{}(6)
   (4) edge node[above]{}(3)
   (5) edge node[above]{}(6);
\end{tikzpicture}
\end{wrapfigure}

Since $\delta$ is small, we can assume that $p$ lies on a necessary unique minimizing geodesic $[x\,x']_M$.
Hence 
\[|x-x'|_M=|x-p|_M+|p-x'|_M.\]
By comparison
\begin{align*}
|\~x-\~x'|_\HH&\ge|x-x'|_M,
\\
|\~x-\~p|_\HH&=|x-p|_M,
\\
|\~x'-\~p|_\HH&=|x'-p|_M.
\end{align*}
By triangle inequality,
\[|\~x-\~x'|_\HH=|\~x-\~p|_\HH+|\~x'-\~p|_\HH;\]
that is, $\~p\in [\~x\,\~x']_\HH$.
The same way we see that $\~p\in [\~y\,\~y']_\HH$.

Fix $\eps$ and $\zeta$.
Note that as $\delta\to 0$ we have 
\begin{align*}
\~x'&\to \~p,
&
\~y'&\to \~p.
\\
\measuredangle[\~p\,^{\~x'}_{\~y}]&\to \measuredangle[p\,^{x'}_{y}],
&
\measuredangle[\~p\,^{\~y'}_{\~x}]&\to \measuredangle[p\,^{y'}_{x}],
\\
\measuredangle[\~p\,^{\~x'}_{\~q'}]&\to \measuredangle[p\,^{x'}_{q'}],
&
\measuredangle[\~p\,^{\~y'}_{\~q'}]&\to \measuredangle[p\,^{y'}_{q'}],
\end{align*}
It follows that 
\begin{align*}
\measuredangle[\~p\,^{\~x}_{\~y}]&\to \measuredangle[p\,^x_y],
&
\measuredangle[\~p\,^{\~x}_{\~q'}]&\to \measuredangle[p\,^x_{q'}],
&
\measuredangle[\~p\,^{\~y}_{\~q'}]&\to \measuredangle[p\,^y_{q'}].
\end{align*}


Therefore, passing to a partial limit as $\delta\to0$, we get a configuration of 5 points 
$\~p, \~x,\~y,\~q'=\~q'(\eps),\~z=\~z(\zeta)$ such that  
\begin{align*}
\measuredangle[\~p\,^{\~x}_{\~y}]&= \measuredangle[p\,^{x}_{y}],
&
\measuredangle[\~p\,^{\~y}_{\~q'}]&= \measuredangle[p\,^{y}_{q'}],
&
\measuredangle[\~p\,^{\~x}_{\~q'}]&= \measuredangle[p\,^{x}_{q'}].
\end{align*}
In other words, the map sending the points $0,u,v,w'\in\T_p$ to $\~p,\~x,\~y,\~q\in\HH$ correspondingly is distance preserving.

Note that $q'\to q$ as $\eps\to0$. 
Therefore, in the limit,
we get a configuration $\~p$, $\~x$, $\~y$, $\~q'$, $\~z=\~z(\zeta)$ such that in addition we have
\begin{align*}
|\~q'-\~z|&=|q-z|,
&
|\~p-\~z|&\ge |p-z|,
\\
|\~x-\~z|&\ge |x-p|,
&
|\~y-\~z|&\ge |y-z|
\end{align*}

Since $w''\ne w'$, for small values $\zeta$ the last three inequalities 
imply 
\[|\~q'-\~z|>|q-z|,\]
a contradiction.


\begin{thm}{Proposition}\label{prop:MTW}
Any cost-convex CTIL Riemannian manifold is MTW.
\end{thm}


\parit{Proof.}
Let $M$ be a cost-convex CTIL Riemannian manifold.

Fix a hinge $[p\,^x_y]$ in $M$.
Since $M$ is CTIL, the hinge $[p\,^x_y]$ has a median; denote it by $[p\,q]$.

For $\delta>0$, define $x'=x'(\delta)$ and $y'=y'(\delta)$ as above.

\begin{wrapfigure}{r}{35 mm}
\begin{tikzpicture}[scale=1,
  thick,main node/.style={circle,draw,font=\sffamily\bfseries,minimum size=8mm}]

  \node[main node] (0) at (3/2,11/6){$x$};
   \node[main node] (1) at (1/2,1/6){$x'$};
  \node[main node] (2) at (3/2,.1){$y$};
  \node[main node] (3) at (1,1){$p$};
  \node[main node] (4) at (1/2,11/6){$y'$};
  \node[main node] (5) at (3,1){$z$};
  \node[main node] (6) at (2,1){$q$};

  \path[every node/.style={font=\sffamily\small}]
     (0) edge node[above]{}(3)
   (1) edge node[above]{}(3)
   (2) edge node[above]{}(3)
   (3) edge node[above]{}(6)
   (4) edge node[above]{}(3)
   (5) edge node[above]{}(6);
\end{tikzpicture}
\end{wrapfigure}

Without loss of generality we can assume that $x,y\zz\in\exp_p(\TIL_p)$.
If $\delta$ is small, the latter implies that $p$ lies on unique minimizing geodesics $[x\,x']$ and $[y\,y']$.

Consider the limit case of the comparison configuration for $p/xx'yy'(q/z)$ as $\delta\to 0$.
It gives a configuration of 5 points $\~p$, $\~q$, $\~x$, $\~y$ and $\~z$ such that
\begin{align*}
\measuredangle[\~p\,^{\~x}_{\~y}]&=\measuredangle[p\,^x_y],
\end{align*}
$\~q$ is the midpoint of $[\~x\, \~y]$.
In particular,
\begin{align*}
2\cdot|\~z-\~q|_\HH^2+|\~q-\~x|_\HH^2+|\~q-\~y|_\HH^2
&=
|\~z-\~x|_\HH^2+|\~z-\~y|_\HH^2,
\\
2\cdot|\~p-\~q|_\HH^2+|\~q-\~x|_\HH^2+|\~q-\~y|_\HH^2
&=
|\~p-\~x|_\HH^2+|\~p-\~y|_\HH^2,
\end{align*}

By the comparison,
\begin{align*}
|\~z-\~x|_\HH&\ge |z-x|_M,
&
|\~z-\~y|_\HH&\ge |z-y|_M,
\\
|\~p-\~x|_\HH&\ge |p-x|_M,
&
|\~p-\~y|_\HH&\ge |p-y|_M,
\\
|\~q-\~x|_\HH&= |q-x|_M,
&
|\~q-\~y|_\HH&= |q-y|_M,
\\
|\~q-\~z|_\HH&= |q-z|_M,
&
|\~q-\~p|_\HH&= |q-p|_M,
\end{align*}
Therefore
\begin{align*}
2\cdot|z-q|_M^2+|q-x|_M^2+|q-y|_M^2
&\ge
|z-x|_M^2+|z-y|_M^2,
\\
2\cdot|p-q|_M^2+|q-x|_M^2+|q-y|_M^2
&\le
|p-x|_M^2+|p-y|_M^2.
\end{align*}
Hence the condition in \ref{MTW} follows.
\qeds


