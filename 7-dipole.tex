\section{Seven point comparison}

Let $M$ be a Riemannian manifold.
The \emph{tangent injectivity locus} at the point $p\in M$ (briefly $\TIL_p$) is defined as the maximal open subset in the tangent space $\T_p$ such that for any $v\in\TIL_p$ the geodesic path $\gamma(t)=\exp_p(v\cdot t)$, $t\in [0,1]$ is a minimizing.
If the tangent injectivity locus at any point $p\in M$ is convex we say that $M$ satisfies \emph{convexity of  tangent injectivity locus} or briefly $M$ is CTIL.

Xi-Nan Ma, Neil Trudinger and Xu-Jia Wang, Xu-Jia introduced a global differential geometric condition which is now called MTW, see \cite{MTW}.
The conditions CTIL and MTW are necessary for the regularity of optimal transport on Riemannian manifold $M$.
Moreover, a slightly stronger version of these conditions gives the converse.

{
\begin{comment}
\begin{wrapfigure}[6]{r}{24 mm}
\begin{tikzpicture}[scale=1,
  thick,main node/.style={circle,draw,font=\sffamily\bfseries,minimum size=3mm}]

  \node[main node] (0) at (1/6,1/2) {};
   \node[main node] (1) at (1/6,3/2) {};
  \node[main node] (2) at (1,0){};
  \node[main node] (3) at (1,1){};
  \node[main node] (4) at (1,2) {};
  \node[main node] (5) at (2,0) {};
  \node[main node] (6) at (2,1) {};

  \path[every node/.style={font=\sffamily\small}]
     (0) edge node[above]{}(3)
   (1) edge node[above]{}(3)
   (2) edge node[above]{}(3)
   (3) edge node[above]{}(6)
   (4) edge node[above]{}(3)
   (5) edge node[above]{}(6);
\end{tikzpicture}
\end{wrapfigure}
\end{comment}

\begin{thm}{Proposition}\label{T=>CTIL+MTW}
Let $T$ be the tree as on the diagram.
If a Riemannian manifold $M$ satisfies the $T$-tree comparison then 
\begin{enumerate}[(a)]
\item\label{T=>CTIL:CTIL} $M$ is CTIL;
\item\label{T=>CTIL:MTW} $M$ is MTW.
\end{enumerate}

\end{thm}

In the proof we will use a reformulation of MTW condition
given by CÃ©dric Villani \cite[2.6]{MTW+CTIL}.
More precisely, we will use the following reformulation of which can be proved the same way.

}

Assume $u,v\in \T_p$ and $w=\tfrac12\cdot(u+v)$
and $x=\exp_p u$, $y=\exp_pv$ and $q=\exp_pw$.
If the three geodesic paths $[p,x]$, $[p,y]$ and $[p,q]$ described by the paths 
$t\mapsto\exp_p(t\cdot u)$,  $t\mapsto\exp_p(t\cdot v)$, $t\mapsto\exp_p(t\cdot w)$ for $t\in[0,1]$ are minimizing, then $[p,q]$ is called \emph{median} of the hinge $[p\,^x_y]$.
Note that in a CTIL Riemannian manifold, any hinge has a median.

\begin{thm}{MTW condition}\label{MTW}
Assume $M$ be a CTIL Riemannian manifold. 
Then $M$ is MTW if and only if for a median $[p,q]$ of any hinge $[p\,^x_y]$ one of the following inequalities
\[
\left[
\begin{aligned}
|p-q|^2_M-|z-q|^2_M&\le |p-x|^2_M-|z-x|^2_M,
\\
|p-q|^2_M-|z-q|^2_M&\le |p-y|^2_M-|z-y|^2_M.
\end{aligned}
\right.
\]
holds for any $z\in M$.
\end{thm}

\parit{Proof; (\ref{T=>CTIL:CTIL}).}
Assume the contrary; that is, there is $p\in M$ and $u,v\zz\in \TIL_p$ such that $w=\tfrac12\cdot(u+v)\notin \TIL_p$.

Let $\tau$ be the maximal value such that the geodesic $\gamma(t)=\exp_p(w\cdot t)$ is a length-minimizing on $[0,\tau]$.
Set $w'=\tau\cdot w$.
Note that $\tau<1$ and $w'\in\partial \TIL_p$.


Set $q=\exp_p w'$.
By general position argument, we can assume that there are at least two minimizing geodesics connecting $p$ to $q$; see \cite{karcher}.
That is, there is $w''\in \partial \TIL_p$ such that $w''\ne w'$ and $\exp_pw'=\exp_pw''$.

\begin{center}
\begin{lpic}[t(-0 mm),b(-0 mm),r(0 mm),l(0 mm)]{pics/7-config(1)}
\lbl[r]{1.5,32;$x$}
\lbl[l]{59.5,31;$y$}
\lbl[t]{18.5,2;$x'$}
\lbl[t]{32.5,2;$y'$}
\lbl[t]{26,4.5;$p$}
\lbl[r]{22.5,16;$z$}
\lbl[r]{25,32;$q$}
\lbl[l]{28.5,27;$q'$}
\end{lpic}
\end{center}

Fix small positive real numbers $\delta,\eps$ and $\zeta$.
Consider the points
\begin{align*}
q'=q'(\eps)&=\exp_p(1-\eps)\cdot w',
&
z=z(\zeta)&=\exp_p(\zeta\cdot w''),
\\
x&=\exp_p u,
&
x'=x'(\delta)&=\exp_p (-\delta\cdot u),
\\
y&=\exp_p v,
&
y'=y'(\delta)&=\exp_p (-\delta\cdot v).
\end{align*}
We will  show that for some choice of $\delta,\eps$ and $\zeta$ the array $p,x,x',y,y',q',z$ does not satisfy the $T$-tree comparison with the labeling as on the diagram below.

\begin{comment}
\begin{wrapfigure}[7]{r}{26 mm}
\begin{tikzpicture}[scale=1,
  thick,main node/.style={circle,draw,font=\sffamily\bfseries,minimum size=7mm}]

  \node[main node] (0) at (1/6,1/2) {$x$};
   \node[main node] (1) at (1/6,3/2) {$x'$};
  \node[main node] (2) at (1,0){$y$};
  \node[main node] (3) at (1,1){$p$};
  \node[main node] (4) at (1,2) {$y'$};
  \node[main node] (5) at (2,0) {$z$};
  \node[main node] (6) at (2,1) {$q'$};

  \path[every node/.style={font=\sffamily\small}]
     (0) edge node[above]{}(3)
   (1) edge node[above]{}(3)
   (2) edge node[above]{}(3)
   (3) edge node[above]{}(6)
   (4) edge node[above]{}(3)
   (5) edge node[above]{}(6);
\end{tikzpicture}
\end{wrapfigure}
\end{comment}

Assume that given  positive numbers $\delta,\eps$ and $\zeta$, there is a point array $\~p$, $\~x$, $\~x'(\delta)$, $\~y$, $\~y'(\delta)$, $\~q'(\eps)$, $\~z(\zeta)\in\HH$ as in the definition of $T$-tree comparison;
that is, the distances between the points in this array are at least as big as the distances of corresponding points in $M$ and the equality holds for the pair adjacent in $T$.

Since $\delta$ is small, we can assume that $p$ lies on a necessary unique minimizing geodesic $[x,x']_M$.
Hence 
\[|x-x'|_M=|x-p|_M+|p-x'|_M.\]
By comparison
\begin{align*}
|\~x-\~x'|_\HH&\ge|x-x'|_M,
\\
|\~x-\~p|_\HH&=|x-p|_M,
\\
|\~x'-\~p|_\HH&=|x'-p|_M.
\end{align*}
By triangle inequality,
\[|\~x-\~x'|_\HH=|\~x-\~p|_\HH+|\~x'-\~p|_\HH;\]
that is, $\~p\in [\~x,\~x']_\HH$.
The same way we see that $\~p\in [\~y,\~y']_\HH$.

Fix $\eps$ and $\zeta$.
Note that as $\delta\to 0$ we have 
\begin{align*}
\~x'&\to \~p,
&
\~y'&\to \~p.
\\
\measuredangle[\~p\,^{\~x'}_{\~y}]&\to \measuredangle[p\,^{x'}_{y}],
&
\measuredangle[\~p\,^{\~y'}_{\~x}]&\to \measuredangle[p\,^{y'}_{x}],
\\
\measuredangle[\~p\,^{\~x'}_{\~q'}]&\to \measuredangle[p\,^{x'}_{q'}],
&
\measuredangle[\~p\,^{\~y'}_{\~q'}]&\to \measuredangle[p\,^{y'}_{q'}],
\end{align*}
It follows that 
\begin{align*}
\measuredangle[\~p\,^{\~x}_{\~y}]&\to \measuredangle[p\,^x_y],
&
\measuredangle[\~p\,^{\~x}_{\~q'}]&\to \measuredangle[p\,^x_{q'}],
&
\measuredangle[\~p\,^{\~y}_{\~q'}]&\to \measuredangle[p\,^y_{q'}].
\end{align*}


Therefore, passing to a partial limit as $\delta\to0$, we get a configuration of 5 points 
$\~p, \~x,\~y,\~q'=\~q'(\eps),\~z=\~z(\zeta)$ such that  
\begin{align*}
\measuredangle[\~p\,^{\~x}_{\~y}]&= \measuredangle[p\,^{x}_{y}],
&
\measuredangle[\~p\,^{\~y}_{\~q'}]&= \measuredangle[p\,^{y}_{q'}],
&
\measuredangle[\~p\,^{\~x}_{\~q'}]&= \measuredangle[p\,^{x}_{q'}].
\end{align*}
In other words, the map sending 4 points $0,u,v,w'\in\T_p$ to $\~p,\~x,\~y,\~q\in\HH$ correspondingly is distance preserving.

Note that $q'\to q$ as $\eps\to0$. 
Therefore, in the limit,
we get a configuration $\~p$, $\~x$, $\~y$, $\~q'$, $\~z=\~z(\zeta)$ such that in addition we have
\begin{align*}
|\~q'-\~z|&=|q-z|,
&
|\~p-\~z|&\ge |p-z|,
\\
|\~x-\~z|&\ge |x-p|,
&
|\~y-\~z|&\ge |y-z|
\end{align*}

Since $w''\ne w'$, for small values $\zeta$ the last three inequalities 
imply 
\[|\~q'-\~z|>|q-z|,\]
a contradiction.





\parit{(\ref{T=>CTIL:MTW}).}
Fix a hinge $[p\,^x_y]$ in $M$.
By \textit{(\ref{T=>CTIL:CTIL})}, $M$ is CTIL.
Therefor $[p\,^x_y]$ has a median; denote it by $[p,q]$.
For $\delta>0$, define $x'=x'(\delta)$ and $y'=y'(\delta)$ as above.

\begin{comment}
\begin{wrapfigure}{r}{26 mm}
\begin{tikzpicture}[scale=1,
  thick,main node/.style={circle,draw,font=\sffamily\bfseries,minimum size=7mm}]

  \node[main node] (0) at (1/6,1/2) {$x$};
   \node[main node] (1) at (1/6,3/2) {$x'$};
  \node[main node] (2) at (1,0){$y$};
  \node[main node] (3) at (1,1){$p$};
  \node[main node] (4) at (1,2) {$y'$};
  \node[main node] (5) at (2,0) {$z$};
  \node[main node] (6) at (2,1) {$q$};

  \path[every node/.style={font=\sffamily\small}]
     (0) edge node[above]{}(3)
   (1) edge node[above]{}(3)
   (2) edge node[above]{}(3)
   (3) edge node[above]{}(6)
   (4) edge node[above]{}(3)
   (5) edge node[above]{}(6);
\end{tikzpicture}
\end{wrapfigure}
\end{comment}

Without loss of generality we can assume that $x,y\zz\in\exp_p(\TIL_p)$.
If $\delta$ is small, the latter implies that $p$ lies on unique minimizing geodesics $[x,x']$ and $[y,y']$.

Consider a limit case $T$-tree comparison as $\delta\to 0$;
we get a configuration of 5 points $\~p$, $\~q$, $\~x$, $\~y$ and $\~z$ such that
\begin{align*}
\measuredangle[\~p\,^{\~x}_{\~y}]&=\measuredangle[p\,^x_y],
\end{align*}
$\~q$ is the midpoint of $[\~x, \~y]$.
In particular,
\begin{align*}
2\cdot|\~z-\~q|_\HH^2+|\~q-\~x|_\HH^2+|\~q-\~y|_\HH^2
&=
|\~z-\~x|_\HH^2+|\~z-\~y|_\HH^2,
\\
2\cdot|\~p-\~q|_\HH^2+|\~q-\~x|_\HH^2+|\~q-\~y|_\HH^2
&=
|\~p-\~x|_\HH^2+|\~p-\~y|_\HH^2,
\end{align*}

By the comparison,
\begin{align*}
|\~z-\~x|_\HH&\ge |z-x|_M,
&
|\~z-\~y|_\HH&\ge |z-y|_M,
\\
|\~p-\~x|_\HH&\ge |p-x|_M,
&
|\~p-\~y|_\HH&\ge |p-y|_M,
\\
|\~q-\~x|_\HH&= |q-x|_M,
&
|\~q-\~y|_\HH&= |q-y|_M,
\\
|\~q-\~z|_\HH&= |q-z|_M,
&
|\~q-\~p|_\HH&= |q-p|_M,
\end{align*}
Therefore
\begin{align*}
2\cdot|z-q|_M^2+|q-x|_M^2+|q-y|_M^2
&\ge
|z-x|_M^2+|z-y|_M^2,
\\
2\cdot|p-q|_M^2+|q-x|_M^2+|q-y|_M^2
&\le
|p-x|_M^2+|p-y|_M^2.
\end{align*}
Hence the condition in \ref{MTW} follows.
\qeds


