\section{All tree comparisons}\label{sec:all-tree}


\parit{Proof of Theorem~\ref{thm:hilbert-quotient}.}
The ``if'' part follows from Exercise~\ref{ex:quotient};
let us prove the ``only if'' part.

Fix a point array $a_1,\dots, a_n$ in $X$.
Consider the complete graph $K_n$ with the vertexes labeled by $a_1,\dots, a_n$.


Let $\hat K_n\to K_n$ be the universal covering.
Denote by $\hat  V$ the set of vertexes of $\hat  K_n$;
given a vertex $\hat  v\in\hat V$ denote by $v$ the corresponding vertex of $K_n$.

Applying the tree comparison for finite subtrees in $\hat  K_n$ and passing to a partial limit,  we get the following:

\begin{enumerate}[$({*})$]
\item There is a map $f\:\hat V\to\HH$ such that 
\[|f(\hat v)-f(\hat w)|_\HH\ge |v-w|_X\]
for any two vertexes $\hat v,\hat w\in \hat  V$ and the equality holds if $(\hat v,\hat w)$ is an edge in $\hat  K_n$.
\end{enumerate}

For $Y=f(\hat V)$ the projection $Y\to X$ defined by $f(\hat v)\mapsto v$ is the required submetry.
It finishes the proof if $X$ is finite.

Since $X$ is separable, it has a countable everywhere dense set $\{a_1,a_2,\dots\}$. 
Applying the statement above for $X_n=\{a_1,\dots a_n\}$, we get 
a submetry from $Y_n=f_n(\hat V_n)\subset \HH$ to $X_n$.

Let $Y$ and $W$ be the ultra-limits of subspaces $Y_n$ and spaces $X_n$ respectfully. 
Clearly $Y$ admits an isometric embedding into a Hilbert space $\HH$ 
and it admits submetry $\phi\:Y\zz\to W$.
The space $X$ can be considered as a subspace of $W$.
Therefore the restriction of $\phi$ to $\phi^{-1}(X)$ is a required submetry.
\qeds


The following proof was suggested by Alexander Lytchak, it is simplified version of the construction of Chuu-Lian Terng and Gudlaugur Thorbergsson given in \cite[Section 4]{terng-thorbergsson}.


\parit{Proof of Proposition~\ref{prop:group}.}
Denote by $G^n$ the direct product of $n$ copies of $G$.
Consider the map $\phi_n\:G^n\to G/\!\!/H$ defined by
\[\phi_n\:(\alpha_1,\dots,\alpha_n)\mapsto [\alpha_1\cdots\alpha_n]_H,\]
where $[x]_H$ denotes the $H$-orbit of $x$ in $G$.

Note that $\phi_n$ is a quotient map for the action of $H\times G^{n-1}$ on $G^n$ defined by
\[(\beta_0,\dots,\beta_n)\cdot(\alpha_1,\dots,\alpha_n)=(\gamma_1\cdot \alpha_1\cdot\beta_1^{-1},\beta_1\cdot\alpha_2\cdot\beta_2^{-1},\dots,\beta_{n-1}\cdot\alpha_n\cdot\beta_n^{-1}),\]
where $\beta_i\in G$ and $(\beta_0,\beta_n)\in H<G\times G$. 

Denote by $\rho_n$ the product metric on $G^n$ rescaled with factor $\sqrt{n}$.
Note that the quotient $(G^n,\rho_n)/(H\times G^{n-1})$ is isometric to $G/\!\!/H=(G,\rho_1)/\!\!/H$.
Let $\phi_n\:(G^n,\rho_n)\to G/\!\!/H$ be the corresponding quotient map; 
clearly $\phi_n$ is a submetry. 

As $n\to\infty$ the curvature of $(G^n,\rho_n)$ converges to zero and its injectivity radius goes to infinity.
Therefore the ultra-limit of $G^n$ as $n\to\infty$ is a Hilbert space $\HH$ and the submetries $\phi_n$ ultra-converge to a submetry $\phi\:\HH\to G/\!\!/H$.
It remains to apply Exercise~\ref{ex:quotient}.
\qeds
